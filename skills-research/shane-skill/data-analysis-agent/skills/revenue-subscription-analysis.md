# 收入与订阅分析 (Revenue & Subscription Analysis)

## 描述

全面分析2025年的收入构成、Bot收入贡献、订阅复购率和用户套餐分布。提供业务全景视图，支持战略决策。

## 何时调用此 Skill

使用此 skill 当你需要：
- ✅ **全面了解收入情况**和增长趋势
- ✅ 分析**Bot收入贡献排行**（哪些 bot 赚钱最多）
- ✅ 计算**订阅复购率**（用户忠诚度）
- ✅ 了解**购买次数分布**（1次、2次、3次...）
- ✅ 分析**套餐销售统计**（Basic/Pro/Developer）
- ✅ 了解**复购订单和升级订单**的比例
- ✅ 制定业务战略和增长计划

**关键词**: 按月收入、复购率、套餐销售、Bot贡献、业务全景、战略决策

## 核心指标

### 1. 按月收入
- 每月总收入（Stripe + PayPal + Apple IAP）
- 收入渠道占比
- 月均收入、最高/最低收入月份

### 2. Bot收入归因
- Bot收入贡献 Top 10
- 归因覆盖率（期望 70-80%）
- 未归因收入分析

### 3. 订阅复购率
- **订阅复购率** = 购买≥2次的用户 / 总付费用户 × 100%
- 购买次数分布（1次、2次、3次、4次+）

### 4. 按月套餐销售统计
- **Basic 订单数**: 当月卖出的 Basic 套餐数量
- **Pro 订单数**: 当月卖出的 Pro/Developer 套餐数量
- **复购订单数**: 用户在分析期间内有过历史订单，本月又购买的订单数
- **升级订单数**: 套餐等级 > 分析期间内历史最高等级的订单数

## 使用方法

### 基本用法

```
分析 2025年 整体收入表现和增长趋势
```

### 参数说明

| 参数 | 说明 | 默认值 | 示例 |
|------|------|--------|------|
| `start_date` | 开始日期 (YYYY-MM-DD) | 2025-10-15 | 2025-10-15 |
| `end_date` | 结束日期 (YYYY-MM-DD) | 今天 | 2025-12-31 |

⚠️ **注意**: `start_date` 默认为 2025-10-15（`art_task` 表第一条数据的日期）

### 高级用法示例

**示例 1: 分析全年收入和增长趋势**
```
分析 2025年 整体收入表现和增长趋势，包括按月收入、Bot贡献、复购率
```

**示例 2: 找出收入贡献最大的 Bot**
```
哪些 bot 贡献了最多收入？Top 10 是哪些？
```

**示例 3: 分析订阅复购率**
```
目前的订阅复购率是多少？高于行业平均水平吗？
有多少用户购买了2次及以上？
```

**示例 4: 分析套餐销售分布**
```
本月 Basic 和 Pro 套餐各卖出多少订单？
有多少用户从 Basic 升级到 Pro/Developer？
```

**示例 5: 对比不同月份表现**
```
对比 10月、11月、12月 的收入、复购率、升级订单变化
```

**示例 6: 分析特定时间段**
```
分析圣诞季（12月15-31日）的收入和套餐销售情况
```

## 输出内容

### 1. 收入汇总

```
======================== 2025年收入分析报告 ========================
分析时间范围: {start_date} 至 {end_date}
分析周期: {days}天

======================== 收入汇总 ========================
总收入: ${total_revenue}
  - Stripe: ${total_stripe} ({stripe_pct}%)
  - PayPal: ${total_paypal} ({paypal_pct}%)
  - Apple IAP: ${total_iap} ({iap_pct}%) [未计折扣]

按月收入:
  - 2025-10: ${month_10_revenue}
  - 2025-11: ${month_11_revenue}
  - 2025-12: ${month_12_revenue}

月均收入: ${avg_monthly_revenue}
最高收入月份: {highest_month} (${highest_revenue})
最低收入月份: {lowest_month} (${lowest_revenue})
```

### 2. Bot收入贡献（Top 10）

```
======================== Bot收入贡献（Top 10）========================
1. {bot_1_name} ({bot_1_slug}): ${bot_1_revenue} ({bot_1_pct}%)
2. {bot_2_name} ({bot_2_slug}): ${bot_2_revenue} ({bot_2_pct}%)
3. {bot_3_name} ({bot_3_slug}): ${bot_3_revenue} ({bot_3_pct}%)
...

归因说明: 使用 Last-Touch 优化版归因模型（±7天窗口）
归因覆盖率: {coverage_rate}%
未归因收入: ${unattributed_revenue} ({unattributed_pct}%)
```

### 3. 订阅复购分析

```
======================== 订阅复购分析 ========================
总付费用户数: {total_paying_users}
复购用户数: {repeat_purchase_users}
订阅复购率: {repeat_purchase_rate}%

购买次数分布:
  - 1次: {count_1} 用户 ({pct_1}%)
  - 2次: {count_2} 用户 ({pct_2}%)
  - 3次: {count_3} 用户 ({pct_3}%)
  - 4次及以上: {count_4plus} 用户 ({pct_4plus}%)
```

### 4. 按月套餐销售统计

```
======================== 按月套餐销售统计 ========================
2025-10 月:
  - Basic 订单: {basic_orders}
  - Pro/Developer 订单: {pro_orders}
  - 复购订单: {repeat_orders} ({repeat_pct}%)
  - 升级订单: {upgrade_orders} ({upgrade_pct}%)
  - 总订单: {total_orders}

2025-11 月:
  - Basic 订单: {basic_orders}
  - Pro/Developer 订单: {pro_orders}
  - 复购订单: {repeat_orders} ({repeat_pct}%)
  - 升级订单: {upgrade_orders} ({upgrade_pct}%)
  - 总订单: {total_orders}

总计（全周期）:
  - Basic 订单: {total_basic_orders}
  - Pro/Developer 订单: {total_pro_orders}
  - 复购订单: {total_repeat_orders} ({total_repeat_pct}%)
  - 升级订单: {total_upgrade_orders} ({total_upgrade_pct}%)
```

### 5. 关键洞察

```
======================== 关键洞察 ========================
1. 收入增长趋势: [上升/平稳/下降]
2. 主力渠道: [Stripe/PayPal/Apple IAP]
3. Top 3 Bot 贡献了 {top3_pct}% 的归因收入
4. 复购率 {repeat_rate}% [高于/低于]行业平均水平
5. [Basic/Pro] 套餐用户占比最高
6. 升级订单占比 {upgrade_pct}%，转化情况 [良好/需改进]
```

### 6. 可视化图表

#### 图表1: 按月收入趋势（堆叠面积图）
- 3层堆叠: Stripe（蓝色）、PayPal（绿色）、Apple IAP（橙色）
- 标注: "Apple IAP 为原价，未计算折扣码优惠"

#### 图表2: Bot收入贡献（Top 10，柱状图）
- X轴: 收入（美元）
- Y轴: Bot名称
- 颜色: 紫色

#### 图表3: 按月套餐销售统计（堆叠柱状图）
- 2层堆叠: Basic（蓝色）、Pro/Developer（紫色）
- X轴: 订单数
- Y轴: 月份

#### 图表4: 按月复购和升级订单（折线图）
- 2条线: 复购订单（绿色）、升级订单（橙色）
- X轴: 月份
- Y轴: 订单数

## 技术说明

### 套餐等级定义

| 套餐类型 | 等级 | 对应 product_id |
|---------|------|----------------|
| FREE | 0 | - |
| Basic/PLAYER | 1 | PLAYER_MONTHLY, PLAYER_YEARLY, energy_500, energy_2000 |
| Pro | 2 | - |
| Developer | 3 | DEVELOPER_MONTHLY, DEVELOPER_YEARLY, 33OFF_DEVELOPER_MONTHLY |

### 复购和升级判断逻辑

**复购判断**: 用户在分析时间范围内（2025-10-15之后），这笔订单之前有过订单

**升级判断**: 本次购买的套餐等级 > 分析时间范围内历史最高套餐等级

**示例**:
```
用户A:
- 10月: 购买 Basic (等级1) → 首次购买
- 11月: 购买 Basic (等级1) → 复购订单（但非升级）
- 12月: 购买 Developer (等级3) → 复购订单 + 升级订单

用户B:
- 10月: 购买 Developer (等级3) → 首次购买
- 11月: 购买 Basic (等级1) → 复购订单（但非升级，反而降级）
```

### 数据来源

- **收入**: `user_subscription_stripe_orders`, `user_subscription_paypal_orders`, `apple_used_transactions`
- **任务**: `art_task`（用于归因）
- **用户**: `user`（用于套餐类型）

### Apple IAP 数据缺失

⚠️ **重要**: `apple_used_transactions` 表从 2025-12-17 开始有数据

**影响**:
- 2025-10 和 2025-11 月的 Apple IAP 收入为 0（数据缺失，非真实值）
- 实际 IAP 收入可能高于统计值（折扣优惠 + 历史数据缺失）
- 图表中应标注此说明

## 与其他分析的关系

- **本文档**: 全面的业务分析报告（收入、复购、套餐）
- **gross-margin-analysis.md**: 整体毛利率（成本角度）
- **bot-margin-analysis.md**: Bot 级别毛利率（产品角度）
- **cost-trend-chart.md**: 用户成本分布（用户角度）

四者结合形成完整的业务分析体系：
1. 收入与订阅分析（本文档）→ 业务增长和用户行为
2. 整体毛利率 → 盈利能力
3. Bot 毛利率 → 产品组合优化
4. 用户成本分布 → 用户获取策略

## 常见问题

**Q1: 复购率多少算正常？**

行业基准（SaaS 订阅业务）:
- **20-30%**: 一般水平
- **30-50%**: 良好水平
- **50%+**: 优秀水平

如果复购率 < 20%，需要关注：
- 产品价值是否足够
- 用户留存策略是否有效
- 是否有替代产品竞争

**Q2: 为什么升级订单少？**

可能原因：
1. Basic 套餐已满足大部分用户需求
2. Pro/Developer 套餐定价过高
3. 缺乏升级引导和激励
4. 用户不了解高级套餐的价值

建议：
- 分析高级套餐的功能使用率
- 优化升级引导流程
- 提供升级优惠或试用

**Q3: Apple IAP 收入为什么这么少？**

⚠️ **数据问题**: `apple_used_transactions` 表从 2025-12-17 才有数据，10月和11月数据完全缺失。

实际 Apple IAP 收入可能远高于统计值。

**Q4: 如何提高复购率？**

策略建议：
1. **优化产品体验**: 让用户持续获得价值
2. **邮件营销**: 定期发送使用报告和新功能介绍
3. **续费提醒**: 订阅到期前提醒续费
4. **忠诚度计划**: 长期用户享受优惠
5. **推荐奖励**: 老用户推荐新用户获得奖励

**Q5: Basic 和 Pro 套餐如何定价？**

根据数据分析：
- 查看 Bot 毛利率，识别高价值 bot
- 分析用户使用量分布，设置合理额度
- 对比竞品定价，确保竞争力
- A/B 测试不同价格点，找到最优定价

## 使用建议

### 定期分析

- **每月运行一次**: 了解月度业务表现
- **季度深度分析**: 制定下季度策略
- **年度总结**: 全年业务回顾和规划

### 战略决策

根据分析结果制定策略：

**如果收入增长放缓**:
- 优化付费转化流程
- 推广高收入 Bot
- 增加营销投入

**如果复购率低**:
- 改善产品体验
- 增强用户粘性功能
- 完善客户成功体系

**如果升级订单少**:
- 优化套餐设计
- 增加高级功能吸引力
- 设计升级引导路径

### 关联分析

结合其他分析报告:
1. 如果整体毛利率低 → 查看 **cost-trend-chart.md**（免费用户成本占比）
2. 如果某个 Bot 收入高 → 查看 **bot-margin-analysis.md**（是否也盈利）
3. 如果收入下降 → 查看 **gross-margin-analysis.md**（成本是否也下降）

## 实现文件

完整实现请参考: `revenue-bot-subscription-analysis.md`
