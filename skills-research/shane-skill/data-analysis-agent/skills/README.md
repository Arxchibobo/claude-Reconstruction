# 数据分析 Skills 索引

本目录包含 6 个数据分析 skill，涵盖收入、成本、毛利率、用户活跃度等多个维度的分析。

## 📊 Skills 总览

| # | Skill 名称 | 文件 | 核心功能 | 适用场景 |
|---|-----------|------|---------|---------|
| 1 | [Bot毛利率分析](#1-bot毛利率分析) | `bot-margin-analysis.md` | 分析每个 bot 的盈利能力 | 产品优化、资源分配 |
| 2 | [Bot收入成本趋势](#2-bot收入成本趋势) | `bot-revenue-cost-trend.md` | 特定 bot 的时间序列表现 | 深入分析单个/多个 bot |
| 3 | [成本趋势分析](#3-成本趋势分析按用户类型) | `cost-trend-by-user-type.md` | 按用户类型的成本分布 | 用户获取策略优化 |
| 4 | [整体毛利率分析](#4-整体毛利率分析) | `gross-margin-analysis.md` | 整体业务盈利能力 | 业务健康度监控 |
| 5 | [失活邮箱域名分析](#5-失活邮箱域名分析) | `inactive-email-domains.md` | 识别失活的邮箱域名 | 白名单管理、用户质量 |
| 6 | [收入与订阅分析](#6-收入与订阅分析) | `revenue-subscription-analysis.md` | 全面的业务分析报告 | 战略决策、增长规划 |

---

## 🎯 快速选择指南

### 按分析目的

| 你想了解... | 使用哪个 Skill | 关键词 |
|------------|---------------|--------|
| 哪些 bot 盈利/亏损 | Bot毛利率分析 | bot、毛利率、盈利 |
| 特定 bot 的趋势变化 | Bot收入成本趋势 | 趋势、时间序列、按天/按周 |
| 免费用户成本占比 | 成本趋势分析 | 免费成本、用户类型 |
| 整体业务是否健康 | 整体毛利率分析 | 整体、毛利率、收入构成 |
| 白名单需要更新哪些域名 | 失活邮箱域名分析 | 白名单、失活、邮箱域名 |
| 全面的业务表现 | 收入与订阅分析 | 按月收入、复购率、套餐销售 |

### 按使用频率

- **每日**: 整体毛利率分析
- **每周**: 成本趋势分析、Bot收入成本趋势
- **每月**: Bot毛利率分析、收入与订阅分析、失活邮箱域名分析
- **按需**: 任何 skill（根据具体问题选择）

---

## 1. Bot毛利率分析

**文件**: `bot-margin-analysis.md`

### 功能
分析每个 bot 的盈利能力，计算各个 bot 的收入、成本和毛利率。

### 核心指标
- Bot 毛利率 = (Bot 收入 - Bot 成本) / Bot 收入 × 100%
- Bot 收入（Last-Touch 优化版归因）
- Bot 成本（actual_energy_cost）

### 使用场景
- ✅ 了解哪些 bot 盈利，哪些亏损
- ✅ 优化 bot 产品组合
- ✅ 决定下线或推广策略
- ✅ 为资源分配提供数据支持

### 示例
```
"分析2025年12月各个 bot 的毛利率表现"
"找出毛利率最高的前10个 bot"
"识别哪些 bot 是亏损的,需要优化或下线"
```

### 输出
- Bot 毛利率排行表（CSV）
- Top 5 高毛利率 Bot
- Bottom 5 低毛利率 Bot
- 负毛利率 Bot 列表
- 未归因订单分析

---

## 2. Bot收入成本趋势

**文件**: `bot-revenue-cost-trend.md`

### 功能
分析特定 bot(s) 的归因收入与成本趋势对比，支持按天和按周两种粒度。

### 核心指标
- 每日/每周归因收入
- 每日/每周实际成本
- 任务数量趋势（成本驱动因素）
- 平均单任务成本

### 使用场景
- ✅ 查看特定 bot 的时间序列表现
- ✅ 对比 bot 的收入和成本随时间变化
- ✅ 了解任务数量趋势
- ✅ 发现成本突增或收入异常时间点
- ✅ 对比多个 bot 的表现差异

### 示例
```
"分析 undress-generator 从上线至今的每日收入成本趋势"
"查看 flux-dev 最近一个月的每周表现"
"对比 ghibli-diffusion 和 anime-diffusion 的成本变化"
```

### 输出
- 收入与成本对比图（折线图）
- 任务数量趋势图
- 汇总数据（总收入、总成本、毛利率）
- 关键发现（峰值日期、原因分析）
- 收入明细（可选）

---

## 3. 成本趋势分析（按用户类型）

**文件**: `cost-trend-by-user-type.md`

### 功能
生成按用户类型堆叠的每日成本趋势图，监控不同用户群体的成本分布。

### 核心指标
- 免费成本占比 = 免费总成本 / 总成本 × 100%
- 6种用户类型成本分布
- 目标：免费成本占比趋势向下 📉

### 用户分类
1. 付费用户
2. 免费-临时邮箱（56个域名）
3. 免费-白名单邮箱（153个域名）
4. 免费-其他邮箱
5. 免费-已删除
6. 免费-访客

### 使用场景
- ✅ 了解不同用户类型的成本分布
- ✅ 监控免费用户成本占比
- ✅ 识别临时邮箱用户的成本消耗
- ✅ 优化用户获取策略
- ✅ 发现成本异常增长的用户群体

### 示例
```
"显示最近7天的每日成本趋势,按用户类型分组"
"分析最近一个月临时邮箱用户的成本变化"
"免费用户成本占比是否在降低?"
```

### 输出
- 堆叠面积图（6种用户类型）
- 成本汇总统计
- 免费用户成本细分
- 趋势分析

---

## 4. 整体毛利率分析

**文件**: `gross-margin-analysis.md`

### 功能
分析业务的整体盈利能力，计算整体毛利率和各维度的毛利率分布。

### 核心指标
- 毛利率 = (收入 - 成本) / 收入 × 100%
- 收入来源占比（Stripe/PayPal/IAP）
- 目标：毛利率持续为正且趋势向上 📈

### 使用场景
- ✅ 了解整体业务的盈利能力
- ✅ 按日/按月查看收入和成本对比
- ✅ 监控毛利率变化趋势
- ✅ 分析不同渠道的收入构成
- ✅ 判断业务是否健康

### 示例
```
"分析2025年12月的整体毛利率表现"
"最近30天毛利率趋势如何?"
"Stripe、PayPal、Apple IAP 各贡献多少收入?"
```

### 输出
- 收入汇总（按渠道）
- 成本与毛利统计
- 按日数据表格（CSV）
- 可视化图表（双轴折线图/堆叠面积图）
- 关键发现

---

## 5. 失活邮箱域名分析

**文件**: `inactive-email-domains.md`

### 功能
分析历史上曾活跃但现已失活的邮箱域名，基于用户最后登录时间判断活跃度。

### 核心指标
- 失活域名总数
- 失活用户总数
- 失活天数（5个等级）
- 主流邮箱失活数

### 失活等级
1. 近期失活 (≤7天) - ⚠️ 观察
2. 短期失活 (7-30天) - ⚠️⚠️ 关注
3. 中期失活 (30-90天) - 🔴 考虑移除
4. 长期失活 (90-180天) - 🔴🔴 建议移除
5. 超长期失活 (>180天) - 🔴🔴🔴 立即移除

### 使用场景
- ✅ 管理白名单，识别需要移除的失活域名
- ✅ 监控用户活跃度
- ✅ 优化用户获取策略
- ✅ 定期清理白名单

### 示例
```
"查询今天10:00后失活的邮箱域名(最近半年有登录)"
"分析本周失活的域名,哪些需要从白名单移除?"
"识别近期失活的主流邮箱域名(gmail、outlook等)"
```

### 输出
- 失活域名列表（按用户数降序）
- 汇总统计（按失活等级分布）
- 主流邮箱失活情况
- 建议操作（立即移除/考虑移除/持续观察）

---

## 6. 收入与订阅分析

**文件**: `revenue-subscription-analysis.md`

### 功能
全面分析2025年的收入构成、Bot收入贡献、订阅复购率和用户套餐分布。

### 核心指标
1. **按月收入**: 每月总收入（Stripe + PayPal + IAP）
2. **Bot收入归因**: Bot收入贡献 Top 10
3. **订阅复购率**: 购买≥2次的用户 / 总付费用户 × 100%
4. **套餐销售统计**: Basic/Pro订单、复购订单、升级订单

### 使用场景
- ✅ 全面了解收入情况和增长趋势
- ✅ 分析 Bot收入贡献排行
- ✅ 计算订阅复购率
- ✅ 了解购买次数分布
- ✅ 分析套餐销售统计
- ✅ 制定业务战略和增长计划

### 示例
```
"分析2025年整体收入表现和增长趋势"
"哪些 bot 贡献了最多收入?(Top 10)"
"目前的订阅复购率是多少?高于行业平均吗?"
"本月 Basic 和 Pro 套餐各卖出多少订单?"
```

### 输出
- 收入汇总（按月、按渠道）
- Bot收入贡献 Top 10
- 订阅复购分析（复购率、购买次数分布）
- 按月套餐销售统计
- 关键洞察
- 可视化图表（4张）

---

## 🔗 Skills 之间的关系

```
┌─────────────────────────────────────────┐
│     收入与订阅分析                        │
│     (业务全景、战略决策)                  │
└─────────────┬───────────────────────────┘
              │
    ┌─────────┴─────────┬─────────────┐
    │                   │             │
┌───▼──────────┐  ┌────▼─────────┐  ┌▼──────────────┐
│整体毛利率分析│  │Bot毛利率分析 │  │成本趋势分析    │
│(业务健康度)  │  │(产品优化)    │  │(用户策略)      │
└──────────────┘  └──┬───────────┘  └────────────────┘
                     │
              ┌──────┴────────┐
              │                │
       ┌──────▼──────┐  ┌─────▼────────────┐
       │Bot收入成本   │  │失活邮箱域名分析   │
       │趋势分析      │  │(白名单管理)       │
       │(深入单bot)   │  │                  │
       └─────────────┘  └──────────────────┘
```

### 分析流程建议

1. **月初**: 运行 `收入与订阅分析`，了解上月整体表现
2. **发现问题**: 根据结果选择深入分析
   - 收入下降 → `Bot毛利率分析` + `整体毛利率分析`
   - 成本过高 → `成本趋势分析`
   - 特定 bot 表现异常 → `Bot收入成本趋势`
3. **定期维护**: 每月运行 `失活邮箱域名分析`，优化白名单

---

## 💡 使用建议

### 1. 定期监控

| 频率 | Skills | 目的 |
|------|--------|------|
| 每日 | 整体毛利率分析 | 了解业务健康度 |
| 每周 | 成本趋势分析 | 监控免费成本占比 |
| 每月 | 收入与订阅分析、Bot毛利率分析、失活邮箱域名分析 | 全面业务回顾和优化 |
| 按需 | Bot收入成本趋势 | 深入分析特定 bot |

### 2. 决策支持

- **产品优化**: Bot毛利率分析 → 识别需要下线或推广的 bot
- **用户运营**: 成本趋势分析 → 优化免费用户策略
- **战略规划**: 收入与订阅分析 → 制定增长计划
- **白名单管理**: 失活邮箱域名分析 → 提升用户质量

### 3. 异常告警

设置监控指标：
- 日毛利率 < 0%
- 免费成本占比 > 70%
- 主流邮箱域名失活
- 复购率持续下降

---

## 📚 技术说明

### 数据来源

- **收入**: `user_subscription_stripe_orders`, `user_subscription_paypal_orders`, `apple_used_transactions`
- **成本**: `art_task.actual_energy_cost`
- **用户**: `user`, `user_privy`

### 归因模型

所有涉及收入归因的 skill 使用 **Last-Touch 优化版**归因模型：
- 订单前归因: 最后使用的 bot
- 订单后归因: 首次使用的 bot（如果订单前无使用）
- 时间窗口: ±7天

### 注意事项

⚠️ **Apple IAP 收入**:
- 按原价计算，未计算折扣码优惠
- `apple_used_transactions` 表从 2025-12-17 开始有数据
- 2025-10 和 2025-11 月数据缺失

⚠️ **任务状态差异**:
- 归因: 只用 `status='done'`
- 成本: 包含 `status IN ('done','cancel')`

---

## 🚀 快速开始

### 方式1: 通过 Claude Code 运行

```bash
# 导航到项目目录
cd "E:\Bobo's Coding cache\shane-skill\data-analysis-agent-main"

# 在 Claude Code 中直接提问
"分析2025年12月各个 bot 的毛利率表现"
```

### 方式2: 通过 base44 运行

参考根目录的 `base44_prompt_mcphub.md`，配置 MCP 客户端后运行。

### 方式3: 直接阅读文档

打开对应的 skill 文件，按照文档中的步骤执行 SQL 查询。

---

## ❓ 常见问题

**Q: 如何选择合适的 skill？**

参考 [快速选择指南](#按分析目的) 或查看上面的详细说明。

**Q: 可以同时运行多个 skill 吗？**

可以，但建议按照分析流程逐步深入（参考 [分析流程建议](#分析流程建议)）。

**Q: 如何更新临时邮箱/白名单列表？**

在原始 md 文件中更新列表，所有 skill 会自动应用新列表。

**Q: 数据查询很慢怎么办？**

- Bot毛利率分析和Bot收入成本趋势使用了 SQL 层归因优化，查询时间 15-45秒
- 其他 skill 查询速度取决于数据量和时间范围
- 建议缩小时间范围或增加数据库索引

---

## 📝 更新日志

- **2025-01-05**: 创建 6 个数据分析 skill 配置文件
- **2025-01-05**: 创建 README 索引文档

---

## 📧 联系方式

如有问题或建议，请联系数据分析团队。

---

**祝分析愉快！📊✨**
